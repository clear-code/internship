# メンターのインターンシップメモ: 2013-06-27

6日目。9:30くらい？-18:00。

以下を実施した。

- groonga-clientのリリース
- groonga-commandのリリース
- ...

## groonga-clientのリリース

groonga-clientをリリースするにあたり、リリース作業の流れについて説明し
た。

リリース作業の流れは以下の通りである。

- 前回のリリースからの変更点のうち「ユーザーにとって大事なこと」をまとめる
- 今回のリリースでのハイライトをまとめる
- gemをリリースする
- アナウンスする
- バージョン番号をあげる

groonga-clientは最初のリリースなので最初の2つの作業をする必要はない。ま
た、今回は広く使ってもらうためのリリースではなく、epub-searcherで使うた
めのリリースなのでアナウンスもしない。が、リリース作業を知ってもらうた
めにすべて説明した。

前回のリリースからの変更点と今回のリリースでのハイライトは
doc/text/news.mdにまとめる。フォーマットは以下の通りである。

    # NEWS

    ## 0.0.2 - 2013-06-29

    ここに0.0.2でのハイライトを英語でまとめる。

    ### Improvements

      * Supported XXX.
      * Added {XXX::YYY#zzz}.
      * Improved speed.

    ### Fixes

      * Fixed a crach bug on exit.
        [GitHub#1] [Reported by Anonymous Coward]

    ### Thanks

      * Anonymous Coward

    ## 0.0.1 - 2013-06-27

    ここに0.0.1でのハイライトを英語でまとめる。

    ### Improvements

      * ...

    ### Fixes

      * ...

    ### Thanks

      * ...

詳細は後述するが、構成は以下の通りとなっている。

- バージョンごとにセクションを作る
- セクションタイトルにはバージョンとリリース日付を含める
- セクション内にハイライトと変更点をまとめる
- 新しいバージョンほど上に配置する

セクションタイトルにリリース日付を含めるのは、該当バージョンがいつリリー
スされたのかを調べるときに便利だからである。

新しいバージョンほど上に配置するのは、新しいバージョンほど有用な情報な
ので先に目に付くようにするためである。

セクション内の内容については以下の通りである。

### 前回のリリースからの変更点のうち「ユーザーにとって大事なこと」をまとめる

前回のリリースからの変更点はバージョン管理システムのログ機能を使って確
認する。gitを使っていて、前回のバージョンに1.0.1タグがついている場合は
以下のようにすればよい。

    % git log --reverse -p 1.0.1..
    commit 1d1f84dfa0841076c523fd436339f6aab5382436
    Author: Kouhei Sutou <kou@clear-code.com>
    Date:   Thu Apr 11 17:24:17 2013 +0900

        Extract computing conditions code as a method
    ---
     lib/groonga/command/select.rb | 17 +++++++++++------
     1 file changed, 11 insertions(+), 6 deletions(-)

    diff --git a/lib/groonga/command/select.rb b/lib/groonga/command/select.rb
    index b06a09e..edcaedc 100644
    ...

各コミットは「commit ...」から始まる行で区切られているので、それをキー
にして順にコミットを確認していくとよい。

コミットの内容をすべて抜き出す必要はない。「ユーザーにとって大事なこと」
だけを抜き出す。この「ユーザーにとって」という視点がとても重要である。

例えば、以下はユーザーにとって大事ではない。

- 挙動は変わらず内部構造を整理しただけの変更。
- テストを追加した。

一方、以下のような変更はユーザーにとって大事である。

- APIを追加・削除・変更した。（ユーザーが使い方を変えなければいけないかもしれないから。）
- ドキュメントを追加・改良した。（ユーザーがより便利に使えるようになるかもしれないから。）
- 速度が向上した。

また、変更点はユーザーがわかるようにユーザーの視点に立って書くこと。例
えば、次の書き方はユーザーの視点に立っていない。

- 検索アルゴリズムをXXXからYYYに変更した。

ユーザーの視点に立って書くということは、ユーザーにとってどう変わるのか
を含めるという事である。例えば、次のように書く。

- 検索速度を10倍に高速化した。

詳細をどこまで書くのかの基準は難しいところであるが、ここで書いているの
は変更点のまとめなので、詳細はここに書かないという基準でよさそうである。
必要そうであれば、詳細は別のところに書いてまとめからはリンクを張るのが
バランスがとれていると思う。

変更点は以下の3つのセクションにわけてまとめる。

- Improvements（改良）
- Fixes（修正）
- Thanks（感謝）

「改良」セクションか「修正」セクションか悩むような変更点は「改良」セク
ションにいれる。そちらの方が開発が進んでいる感がでるためである。

変更点がユーザーからの報告を契機にしていた場合はまとめたときにそれに関
する情報を付け加える。具体的には「どこで報告されたか」と「だれが報告し
たか」という情報を付け加える。例えば、Taro YamadaさんがGitHubのIssue 3
番でバグレポートしてくれて、今回のリリースでそのバグを修正していたら以
下のように書く。

    ### Fixes

      * Fixed a crash bug.
        [GitHub#3] [Reported by Taro Yamada]

そして、報告者を「感謝」セクションにも書く。

    ### Thanks

      * Taro Yamada

このように、開発に協力してくれた人の成果とその人への感謝を明示的に示す
ことは重要である。これは、感謝していると思っているだけではその人には伝
わらないからである。感謝しているなら明示的に示さなければいけない。また、
単に感謝していると示すだけではなく、「具体的に○○に関して感謝している」
と伝えることは、より感謝していることが伝えたいからである。誰にでも見え
るところで感謝していることを伝えることも、より感謝していることを伝えた
いからである。

自分が他のフリーソフトウェアのプロジェクトに貢献し、感謝してもらった経
験からするとリリース時に自分が貢献したことを示してもらえるとうれしかっ
た。そのため、自分が貢献してもらったときも同じように感謝したいのである。

### 今回のリリースでのハイライトをまとめる

今回のリリースでのハイライトはまとめた変更点の中から以下の基準で選ぶ。
ハイライトをまとめるときもユーザーの視点で選ぶ。

- 特にオススメしたい変更点（例えば、劇的に高速になったとかすごい便利な機能が増えたとか）
- 注意しないといけない点（例えば、非互換があるので通常と違うアップデート方法にしないといけないとか）

また、アップデートした方がよいかの情報も付け加える。セキュリティー関連
のバグを修正したのならユーザー全員に迅速なアップデートをオススメする。
特定の環境でのみ発生する問題を修正したのならその環境以外の人はアップデー
トしなくても問題ないと伝える。といった具合である。自分がユーザーならアッ
プデートした方がよいのかどうかは気になるはずである。

### gemをリリースする

以下のコマンドでgitのタグをうったり、RubyGems.orgにpushしたりをまとめて
やってくれる。ただし、事前にRubyGems.orgへの登録が必要。これは5日目にやっ
てもらっていた。

    % rake release

このコマンドは中で `gem push` を実行しているが、一番最初に実行したとき
はRubyGems.orgのアカウント情報を入力しなければいけない。2回目以降はしな
くてもよい。

### アナウンスする

今回は広く使ってもらいたいというリリースではなく、epub-searcherで使いた
いというリリースなので、アナウンスは省略する。

### バージョン番号をあげる

リリースしたらバージョン番号をあげる。lib/groonga/client/version.rbの
中の `VERSION` のマイクロバージョン（一番右側の数字）を1つあげる。

    module Groonga
      class Client
        VERSION = "0.0.2"
      end
    end

とても重要な機能が入った場合や、非互換が発生するという場合、特別な時期
（年に一度の肉の日など）はメジャーバージョン（一番左の数字）を上げるが、
通常はマイクロバージョンをあげればよい。もし、マイクロバージョンが9まで
いっていたらマイナーバージョン（真ん中の数字）を上げる。例えば、0.0.9な
ら0.1.0にする。

## groonga-commandのリリース

groonga-commandのowner権限がなかったので準備だけした。

TODO: ...
